<!doctype html>
<html lang="en">
<head>
  <base href="./">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Flat-Rate Tracker</title>
  <link rel="icon" href="./icon-192.png">
  <link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#0b0b0b" />
  <link rel="stylesheet" href="./app.css">
</head>
<body data-page="main">
<header>
  <h1>Flat-Rate Tracker</h1>
  <a class="btn primary" href="./more.html">More</a>
</header>

<div id="statusMsg" class="muted small" style="max-width:780px;margin:10px auto 0;padding:0 16px;"></div>

<main>
  <section class="card">
    <div class="row u-row u-wrap" style="justify-content:space-between;">
      <div class="mono" style="font-size:13px; opacity:.85;" id="rangeTitle">Today</div>

      <div class="seg rangeTabs" role="tablist" aria-label="Range">
        <button id="rangeDayBtn" type="button" class="segBtn active">Day</button>
        <button id="rangeWeekBtn" type="button" class="segBtn">Week</button>
        <button id="rangeMonthBtn" type="button" class="segBtn">Month</button>
        <button id="rangeAllBtn" type="button" class="segBtn">All</button>
      </div>
    </div>

    <div id="weekWhichRow" class="seg" style="margin-top:10px; display:none;">
      <button id="weekThisBtn" type="button" class="segBtn active">This Week</button>
      <button id="weekLastBtn" type="button" class="segBtn">Last Week</button>
    </div>

    <div class="pillRow" style="margin-top:10px;">
      <div class="pill">
        <div class="k">Hours</div>
        <div class="v" id="rangeHours">0.0</div>
        <div class="muted" id="rangeSub">—</div>
      </div>
      <div class="pill">
        <div class="k">$</div>
        <div class="v" id="rangeDollars">$0.00</div>
      </div>
      <div class="pill">
        <div class="k">Entries</div>
        <div class="v" id="rangeCount">0</div>
      </div>
      <div class="pill">
        <div class="k">Avg hrs/entry</div>
        <div class="v" id="rangeAvgHrs">0.0</div>
      </div>
    </div>
  </section>

  <section id="weekBreakdownCard" class="card" style="display:none;">
    <div class="muted">This Week Breakdown (tap a day to filter the list)</div>
    <div id="weekBreakdownList" class="list" style="margin-top:12px;"></div>
  </section>

  <div id="legacyTotals">
    <section class="card">
      <div class="summary">
        <div class="pill"><div class="k">Today Hours</div><div class="v" id="todayHours">0</div></div>
        <div class="pill"><div class="k">Today $</div><div class="v" id="todayDollars">$0.00</div></div>
        <div class="pill"><div class="k">Entries Today</div><div class="v" id="todayCount">0</div></div>
      </div>
    </section>

    <section class="card">
      <div class="summary">
        <div class="pill"><div class="k">This Week Hours</div><div class="v" id="weekHours">0</div><div class="muted" id="weekRange"></div></div>
        <div class="pill"><div class="k">This Week $</div><div class="v" id="weekDollars">$0.00</div></div>
        <div class="pill">
          <div class="k">Week Difference</div>
          <div class="v" id="weekDelta">0</div>
          <div id="weekDeltaHint" class="muted small"></div>
        </div>
      </div>
    </section>
  </div>

  <section class="card fr26">
    <form id="logForm" class="fr26Form">

      <!-- Employee -->
      <section class="fr26Group">
        <div class="fr26GroupHeader">Employee</div>

        <div class="fr26Row">
          <label class="fr26Label" for="empId">Employee #</label>
          <input id="empId" inputmode="numeric" placeholder="e.g. 12345" autocomplete="off" class="fr26Input" />
        </div>
        <div class="fr26Hint">Required. Entries are stored under this number on this device.</div>
      </section>

      <!-- Rapid Log -->
      <section class="fr26Group">
        <div class="fr26TopRow">
          <div>
            <div class="fr26GroupHeader" style="margin:0;">Rapid Log</div>
            <div class="fr26Sub">Fast entry. Expand only when you need VIN/photo/notes.</div>
          </div>
          <button id="toggleDetailsBtn" class="fr26Chip" type="button">More</button>
        </div>

        <div class="fr26Row">
          <label class="fr26Label" for="ref">RO / Stock #</label>
          <input
            id="ref"
            name="ref"
            placeholder="e.g. 123456 or AB12C"
            inputmode="text"
            autocomplete="off"
            autocapitalize="characters"
            spellcheck="false"
            required
            class="fr26Input"
          />
        </div>

        <div class="fr26Row">
          <label class="fr26Label" for="typeText">Job Type</label>
          <input
            name="typeText"
            id="typeText"
            list="typeList"
            placeholder="Sold + FPF"
            inputmode="text"
            autocomplete="off"
            required
            class="fr26Input"
          />
          <datalist id="typeList"></datalist>
        </div>
        <div class="fr26Hint">Just type it. New types auto-save and show up next time.</div>

        <div class="fr26Row">
          <label class="fr26Label" for="hours">Hours</label>
          <input
            id="hours"
            name="hours"
            type="number"
            step="0.1"
            min="0"
            inputmode="decimal"
            placeholder="0.5"
            required
            class="fr26Input"
          />
        </div>
      </section>

      <!-- Details panel (keeps same id) -->
      <section id="detailsPanel" class="fr26Details" style="display:none;">
        <div class="fr26Group">
          <div class="fr26GroupHeader">Details</div>

          <div class="fr26TopRow" style="margin-top:6px;">
            <div class="fr26Sub">Reference type</div>
            <div class="seg" role="tablist" aria-label="Reference type">
              <button id="refTypeRO" type="button" class="segBtn active">RO</button>
              <button id="refTypeSTK" type="button" class="segBtn">Stock</button>
            </div>
          </div>

          <div class="fr26Row">
            <label class="fr26Label" for="vin8">VIN (last 8)</label>
            <input
              id="vin8"
              name="vin8"
              placeholder="1A2B3C4D"
              maxlength="8"
              inputmode="text"
              autocomplete="off"
              autocapitalize="characters"
              spellcheck="false"
              class="fr26Input"
            />
          </div>

          <div class="fr26Row">
            <label class="fr26Label" for="rateInput">Rate ($)</label>
            <input id="rateInput" name="rate" type="number" inputmode="decimal" min="0" step="0.01" value="15" class="fr26Input" />
          </div>

          <div class="fr26Row">
            <label class="fr26Label">Proof Photo</label>
            <button id="btnPickPhoto" class="btn" type="button">Pick Photo</button>
            <input id="photoPicker" type="file" style="display:none">

            <button id="btnTakePhoto" class="btn" type="button">Take Photo</button>
            <input id="photoCamera" type="file" style="display:none">

            <button id="btnPickFile" class="btn" type="button">Pick File</button>
            <input id="photoFile" type="file" style="display:none">

            <div id="photoPickedLabel">No photo</div>
          </div>
          <div class="fr26Hint">Tip: 1 photo per RO is enough.</div>

          <div class="fr26Row fr26RowMultiline">
            <label class="fr26Label" for="notesBox">Notes</label>
            <textarea id="notesBox" name="notes" placeholder="Anything that will matter later..." class="fr26Textarea"></textarea>
          </div>
        </div>
      </section>

      <!-- Sticky action bar -->
      <div class="fr26ActionBar">
        <button id="clearBtn" class="fr26BtnGhost" type="button">Clear</button>
        <button id="cancelEditBtn" class="fr26BtnGhost" type="button" style="display:none;">Cancel Edit</button>
        <button id="saveBtn" class="fr26BtnPrimary" type="submit">Save</button>
      </div>

    </form>
  </section>
  <div id="toast" class="toast" aria-live="polite"></div>

  <div id="photoModal" class="modalShell">
    <div class="modalContent" style="max-width:900px; margin:20px auto; padding:0 16px;">
      <div class="card" style="padding:14px;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
          <div class="mono" id="photoMeta" style="font-size:12px; color:#9aa4b2;"></div>
          <button class="btn" id="closePhotoBtn" type="button">Close</button>
        </div>
        <img id="photoImg" alt="Proof photo" style="width:100%; height:auto; border-radius:14px; margin-top:12px; display:block;" />
      </div>
    </div>
  </div>

  <section class="card">
    <div class="itemTop">
      <div>
        <div class="muted">Recent Entries (newest first)</div>
        <div class="muted">Search works across RO/Stock, VIN8, Type, Notes.</div>
      </div>
      <div class="right">
        <div class="muted">Filter</div>
        <select id="filterSelect" style="margin-top:6px; width:120px;">
          <option value="today">Today</option>
          <option value="all">All</option>
        </select>
        <div class="row u-row u-wrap" style="justify-content:flex-end; margin-top:6px;">
          <button class="btn" id="historyBtn" type="button">History</button>
          <button class="btn primary" id="exportCsvMainBtn" type="button">Export CSV</button>
        </div>
      </div>
    </div>

    <div class="card card--tight" style="margin-top:12px">
      <div class="row" style="gap:10px; align-items:center">
        <input id="searchInput" placeholder="Search RO, VIN, type, notes..." 
          style="flex:1;min-width:220px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.25);color:#e7eefc" />
        <button class="btn" type="button" id="clearSearchBtn">Clear</button>
      </div>
      <div class="muted" id="filterStatus" style="margin-top:8px"></div>
    </div>

    <div class="list" id="entryList" style="margin-top:12px;"></div>
  </section>

  <section class="card" id="historyPanel" style="display:none;">
    <div class="itemTop">
      <div>
        <div class="mono">Work History</div>
        <div class="muted small" id="historyMeta"></div>
      </div>
      <div class="right">
        <button class="btn" id="closeHistoryBtn" type="button">Close</button>
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="historySearchInput" placeholder="Search RO/Stock, VIN8, Type, Notes…" style="width:100%;" />
    </div>

    <div class="row" style="margin-top:10px; gap:10px; flex-wrap:wrap;">
      <select id="histRange" style="width:160px;">
        <option value="week">This Week</option>
        <option value="lastweek">Last Week</option>
        <option value="month">This Month</option>
        <option value="all">All Time</option>
      </select>

      <select id="histGroup" style="width:160px;">
        <option value="none">No Group</option>
        <option value="day">Group by Day</option>
      </select>
    </div>

    <div class="divider"></div>
    <div id="historyList" class="list"></div>
  </section>
</main>

<script src="https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/flat-rate-log/app.3f93787f76.js" defer></script>
</body>
</html>
